{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load static %}
{% block title %}Chamadas{% endblock title %}

{% block content %}

    <div class="table-background container justify-content-center">

        <div class="content-header">
            <h3 class="poppins-bold">Cadastrar Chamada</h3>
            <p class="lead">Preencha todos os campos obrigatórios:</p>
        </div>
    
        <hr>

        <form action="" method="POST">
            {% csrf_token %}

            <div class="w-25">
                {{ form|crispy }}
            </div>

            {% if form_product %}
                <h3>Produtos da Chamada</h3>
                {{ form_product.management_form}} 
                <div class="table-responsive">
                    <table class="table ">
                        <thead>
                            <tr>
                                <td>Produtos</td>
                                <td>Preço (R$)</td>
                                <td>Saldo do Produto</td>
                                <td>Apagar</td>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                        {% for form in form_product %}
                            <tr class='inlineform'>
                                <td>{{ form.product|as_crispy_field }}</td>
                                <td>{{ form.price|as_crispy_field }}</td>
                                <td>{{ form.balance|as_crispy_field }}</td>
                                <td></td>
                            </tr>
                        {% endfor %}
                    </table>    
                </div>
            
            {% endif %}

            <button type="submit" class="btn btn-success">Cadastrar</button>
        </form>

    </div>
{% endblock content %}

{% block script %}
    <script type="text/javascript">
        $(function() {
            $('.inlineform').formset({
                prefix: '{{ form_product.prefix }}',
                addText: '<button type="submit" class="btn btn-success btn-sm">+</button>',
                deleteText: '<button type="submit" class="btn btn-danger btn-sm"><i class="bi bi-trash3-fill"></i></button>',
                //hideLastAddForm: true,
            });
        })
    </script>
{% endblock script %}